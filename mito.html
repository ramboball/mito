<html>
<head>
<title>mito</title>
<script type="text/javascript">
var conn;
var win = { w:0, h:0, ctx:{}, e:{}, mouse: { x:0, y:0 }, game:{} };
var cam = { pos: { x:0, y:0 }, z:1, attach:{} };
var field = { x: 4096, y: 4096 };

function Game() {
    var ret = {
        players: [],
        food: [],
        lastTick: 0,
        fps: 60,
        _int: {},
    };
    ret.update = (function() {
        var ctime = (new Date).getTime();
        var d = ctime - this.lastTick;
        this.draw();
        this.lastTick = ctime;
    }).bind(ret);
    ret.draw = (function() {
    }).bind(ret);
} 

function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
    };
}

document.addEventListener('DOMContentLoaded', function() {
    if (window["WebSocket"]) {
        conn = new WebSocket("ws://{{$}}/ws");
        conn.onclose = function(e) {
            console.log("connection closed")
        }
        conn.onmessage = function(e) {
            console.log("message received", e.data)
        }
    } else {
        console.log("websockets not supported")
    }

    win.e = document.getElementById('mito');
    win.e.addEventListener('mousemove', function(e) {
        win.mouse = getMousePos(win.e, e);
    });
    function setCanvasDim(e) {
        win.w = win.e.offsetWidth;
        win.h = win.e.offsetHeight;
        win.e.width = win.w;
        win.e.height = win.h;
    }
    window.addEventListener('resize', setCanvasDim);
    setCanvasDim();
    win.ctx = win.e.getContext('2d');
    win.ctx.fillStyle = '#444444';
})
</script>
<style type="text/css">
* { margin:0; }
</style>
</head>
<body>
    <canvas id="mito" style="height:100%;width:100%" />
</body>
</html>
